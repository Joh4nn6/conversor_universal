<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Conversor Universal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <!-- Librer√≠as externas -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.1.4/docx.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <!-- html2pdf para exportaci√≥n PDF multip√°gina -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <header class="hero">
    <h1><span class="icon">‚ö°</span> Conversor <span class="gradient">Universal</span></h1>
    <p>Convierte <strong>Markdown</strong> y <strong>HTML</strong> a m√∫ltiples formatos ‚Äî con estilo gal√°ctico.</p>
  </header>

  <main class="main-grid">
    <section class="editor glass">
      <label for="input">‚úçÔ∏è Tu contenido (MD/HTML)</label>
      <textarea id="input" placeholder="# Hola universo üåå&#10;**Negrita**, _cursiva_, `c√≥digo`‚Ä¶"></textarea>
      <input type="file" id="fileInput" accept=".md,.html,.txt" />
    </section>
    <section class="preview glass">
      <h3>üëÄ Vista Previa</h3>
      <div id="preview"></div>
    </section>
  </main>

  <div class="actions">
    <button class="btn btn-primary" onclick="exportPDF()">Exportar a PDF</button>
    <button class="btn btn-primary" onclick="exportDOCX()">Exportar a DOCX</button>
    <button class="btn btn-primary" onclick="exportPNG()">Exportar a PNG</button>
    <button class="btn btn-primary" onclick="exportTXT()">Exportar a TXT</button>
    <button class="btn btn-primary" onclick="exportMD()">Exportar a MD</button>
    <button class="btn btn-ghost" onclick="clearText()">Limpiar</button>
  </div>

  <script>
    // Referencias a elementos del DOM
    const input = document.getElementById('input');
    const preview = document.getElementById('preview');

    // Renderiza la vista previa desde Markdown/HTML
    function updatePreview() {
      const text = input.value || '';
      const html = marked.parse(text);
      preview.innerHTML = html;
    }
    updatePreview();
    input.addEventListener('input', updatePreview);

    // Cargar archivos locales
    document.getElementById('fileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          input.value = ev.target.result;
          updatePreview();
        };
        reader.readAsText(file);
      }
    });

    // Limpiar
    function clearText() {
      input.value = '';
      preview.innerHTML = '';
    }

    // Exportar a PDF con html2pdf.js
    function exportPDF() {
      if (!input.value.trim()) {
        alert('No hay contenido para exportar.');
        return;
      }
      const element = document.getElementById('preview');
      html2pdf().from(element).set({
        margin: 1,
        filename: 'output.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, backgroundColor: '#ffffff' },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).save();
    }

    // Exportar a DOCX
    function exportDOCX() {
      if (!input.value.trim()) {
        alert('No hay contenido para exportar.');
        return;
      }
      const { Document, Packer, Paragraph } = window.docx;
      const paragraphs = input.value.split('\\n').map(line => new Paragraph(line));
      const doc = new Document({
        sections: [
          {
            properties: {},
            children: paragraphs,
          },
        ],
      });
      Packer.toBlob(doc).then(blob => {
        saveAs(blob, 'output.docx');
      });
    }

    // Exportar a PNG
    function exportPNG() {
      if (!input.value.trim()) {
        alert('No hay contenido para exportar.');
        return;
      }
      html2canvas(preview).then(canvas => {
        canvas.toBlob(blob => {
          saveAs(blob, 'output.png');
        });
      });
    }

    // Exportar a TXT
    function exportTXT() {
      if (!input.value.trim()) {
        alert('No hay contenido para exportar.');
        return;
      }
      const blob = new Blob([input.value], { type: 'text/plain;charset=utf-8' });
      saveAs(blob, 'output.txt');
    }

    // Exportar a MD
    function exportMD() {
      if (!input.value.trim()) {
        alert('No hay contenido para exportar.');
        return;
      }
      const blob = new Blob([input.value], { type: 'text/markdown;charset=utf-8' });
      saveAs(blob, 'output.md');
    }
  </script>
</body>
</html>
